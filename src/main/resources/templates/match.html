<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>ë§¤ì¹­ ì¶”ì²œ</title>
  <meta charset="UTF-8">
  <style>
    .card {
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 1rem;
      margin: 1rem 0;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .card h3 {
      margin: 0.5rem 0;
    }

    .tag {
      display: inline-block;
      background-color: #f0f0f0;
      border-radius: 8px;
      padding: 0.2rem 0.5rem;
      margin: 0.2rem;
      font-size: 0.9rem;
    }

    .button {
      margin-top: 1rem;
    }
  </style>
</head>
<body>
<h2>ë§¤ì¹­ ì¶”ì²œ ëª©ë¡</h2>

<div id="recommendation-list"></div>

<a href="/profile">ë‚´ í”„ë¡œí•„ë¡œ</a>
<a href="/home">
  <button type="button">í™ˆìœ¼ë¡œ</button>
</a>
<script>
  const token = localStorage.getItem('jwtToken');
  console.log("JWT Token:", token);

  if (!token) {
    alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
    window.location.href = "/login";
  }

  fetch('/api/match/recommendations', {
    method: 'GET',
    headers: {
      'Authorization': 'Bearer ' + token
    }
  })
          .then(res => {
            if (!res.ok) {
              // ì´ë•Œ HTML (ì˜ˆ: ë¡œê·¸ì¸ í˜ì´ì§€) ì´ ë°˜í™˜ë  ìˆ˜ ìˆìŒ
              throw new Error("ì¸ì¦ ì‹¤íŒ¨ ë˜ëŠ” ì„œë²„ ì˜¤ë¥˜");
            }
            return res.json();
          })
          .then(data => {
            const container = document.getElementById('recommendation-list');

            if (!data.length) {
              container.innerHTML = '<p>ì¶”ì²œ ëŒ€ìƒì´ ì—†ìŠµë‹ˆë‹¤ ğŸ˜¥</p>';
              return;
            }

            data.forEach(user => {
              const card = document.createElement('div');
              card.className = 'card';

              card.innerHTML = `
                <h3>${user.name} (${user.mbti})</h3>
                <p>ê³µí†µ íƒœê·¸: ${user.commonTags.map(tag => `<span class="tag">${tag}</span>`).join('')}</p>
                <p>ë§¤ì¹­ ì ìˆ˜: <strong>${user.score}</strong></p>
                <button class="button" onclick="startChat('${user.email}')">ì±„íŒ… ì‹œì‘</button>
               ` ;


              container.appendChild(card);
            });
          })
          .catch(err => {
            console.error("ë§¤ì¹­ ì¶”ì²œ ì—ëŸ¬:", err);
            alert("ì¶”ì²œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
          });
  function startChat(targetEmail) {
    const encoded = encodeURIComponent(targetEmail);
    window.location.href = `/chat/room?with=${encoded}`;
  }
</script>
</body>
</html>
